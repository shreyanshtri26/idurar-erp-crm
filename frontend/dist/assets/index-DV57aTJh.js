import{aS as _,b7 as V,aU as P,a as x,aT as e}from"./index--J6gaKqH.js";import{c as b}from"./actions-Bt69AeFc.js";import{u as A,C as te}from"./index-sTiArh6c.js";import{ae as z,V as K,ai as se,O as G,U as Q,al as oe,C as ne,ac as X,aa as W,$ as J,aL as ae,aM as le,a7 as ce,a8 as re,X as ie,af as de,Y as ue}from"./erpOs-CMKQyu82.js";import{a as Z,R as pe}from"./helpers-B3L87vXg.js";import{M as xe}from"./index-CEBP3NLi.js";import{d as k,P as he}from"./index-BcAYd26p.js";import{a as ee,u as me}from"./useDate-BUBJ-65Y.js";import{u as fe}from"./useDebounce-CK9jXVuP.js";import{S as be,c as je}from"./countryList-BECIveE_.js";import{s as H}from"./index-KrFx5yLV.js";import{c as Ce}from"./color-DHucoY0N.js";import{T as v}from"./index-BXLypoqc.js";import{D as ge}from"./DeleteOutlined-DpfJlTkJ.js";import{e as Se,D as Ie,E as Te,h as Be}from"./ErpApp-BEAjmWaO.js";import{A as ve,a as ye}from"./ArrowRightOutlined-BulyMten.js";import{T as we}from"./Table-BPtJoJS3.js";function De(){return Se()}const Ae={useBreakpoint:De},O=a=>a.crud,Ee=_([O],a=>a.current),Le=_([O],a=>a.list),_e=_([O],a=>a.create),ut=_([O],a=>a.update);_([O],a=>a.read);const Oe=_([O],a=>a.delete),Fe=_([O],a=>a.search);function pt({config:a,formElements:s,withUpload:r=!1}){let{entity:c}=a;const d=V(),{isLoading:o,isSuccess:t}=P(_e),{crudContextAction:i}=A(),{panel:m,collapsedBox:f,readBox:C}=i,[p]=z.useForm(),n=K(),l=u=>{u.file&&r&&(u.file=u.file[0].originFileObj),d(b.create({entity:c,jsonData:u,withUpload:r}))};return x.useEffect(()=>{t&&(C.open(),f.open(),m.open(),p.resetFields(),d(b.resetAction({actionType:"create"})),d(b.list({entity:c})))},[t]),e.jsx(se,{isLoading:o,children:e.jsxs(z,{form:p,layout:"vertical",onFinish:l,children:[s,e.jsx(z.Item,{children:e.jsx(G,{type:"primary",htmlType:"submit",children:n("Submit")})})]})})}function xt({config:a}){const s=K();let{entity:r,deleteModalLabels:c,deleteMessage:d=s("are_you_sure_you_want_to_delete"),modalTitle:o=s("delete_confirmation")}=a;const t=V(),{current:i,isLoading:m,isSuccess:f}=P(Oe),{state:C,crudContextAction:p}=A(),{appContextAction:n}=Q(),{panel:l,readBox:u}=p,{navMenu:y}=n,{isModalOpen:S}=C,{modal:g}=p,[w,D]=x.useState("");x.useEffect(()=>{if(f&&(console.log("ðŸš€ ~ useEffect ~ DeleteModal isSuccess:",f),g.close(),t(b.list({entity:r}))),i){let B=c.map(N=>Z(i,N)).join(" ");D(B)}},[f,i]);const E=()=>{const B=i._id;t(b.delete({entity:r,id:B})),u.close(),g.close(),l.close(),y.collapse()},T=()=>{m||g.close()};return e.jsx(xe,{title:o,open:S,onOk:E,onCancel:T,confirmLoading:m,children:e.jsxs("p",{children:[d,w]})})}const Pe=({fields:a,translate:s})=>{let r=[];return Object.keys(a).forEach(c=>{let d=a[c];r.push({title:d.label?d.label:c,dataIndex:d.dataIndex?d.dataIndex.join("."):c,isDate:d.type==="date"})}),r};function Ne({fields:a,translate:s,moneyFormatter:r,dateFormat:c}){let d=[];return Object.keys(a).forEach(o=>{let t=a[o];const i=t.dataIndex?t.dataIndex:[o],m={boolean:{title:t.label?s(t.label):s(o),dataIndex:i,onCell:()=>({props:{style:{width:"60px"}}}),render:(p,n)=>e.jsx(be,{checked:n[o],checkedChildren:e.jsx(oe,{}),unCheckedChildren:e.jsx(ne,{})})},date:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{const l=k(n[o]).format(c);return e.jsx(v,{bordered:!1,color:t.color,children:l})}},currency:{title:t.label?s(t.label):s(o),dataIndex:i,onCell:()=>({style:{textAlign:"right",whiteSpace:"nowrap"}}),render:(p,n)=>r({amount:n[o],currency_code:n.currency})},async:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{var l;return e.jsx(v,{bordered:!1,color:t.color||((l=n[o])==null?void 0:l.color)||n.color,children:p})}},color:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{var l;return e.jsx(v,{bordered:!1,color:p,children:(l=Ce.find(u=>u.value===p))==null?void 0:l.label})}},stringWithColor:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>e.jsx(v,{bordered:!1,color:n.color||t.color,children:p})},tag:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>e.jsx(v,{bordered:!1,color:t.color,children:n[o]&&n[o]})},selectWithFeedback:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{if(t.renderAsTag){const l=t.options.find(u=>u.value===n[o]);return e.jsx(v,{bordered:!1,color:l==null?void 0:l.color,children:n[o]&&s(n[o])})}else return n[o]&&s(n[o])}},select:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{if(t.renderAsTag){const l=t.options.find(u=>u.value===n[o]);return e.jsx(v,{bordered:!1,color:l==null?void 0:l.color,children:n[o]&&n[o]})}else return n[o]&&n[o]}},selectWithTranslation:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{if(t.renderAsTag){const l=t.options.find(u=>u.value===n[o]);return e.jsx(v,{bordered:!1,color:l==null?void 0:l.color,children:n[o]&&s(n[o])})}else return n[o]&&s(n[o])}},array:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>n[o].map(l=>e.jsx(v,{bordered:!1,color:t.colors[l],children:l},`${H.generate()}`))},country:{title:t.label?s(t.label):s(o),dataIndex:i,render:(p,n)=>{const l=je.find(u=>u.value===n[o]);return e.jsxs(v,{bordered:!1,color:t.color||void 0,children:[(l==null?void 0:l.icon)&&(l==null?void 0:l.icon)+" ",(l==null?void 0:l.label)&&s(l.label)]})}}},f={title:t.label?s(t.label):s(o),dataIndex:i},C=t.type;t.disableForTable||(Object.keys(m).includes(C)?d.push(m[C]):d.push(f))}),d}function ht({config:a}){const{dateFormat:s}=ee();let{readColumns:r,fields:c}=a;const d=K(),{result:o}=P(Ee),{state:t}=A(),{isReadBoxOpen:i}=t,[m,f]=x.useState([]);c&&(r=[...Pe({fields:c,translate:d})]),x.useEffect(()=>{const n=[];r.map(l=>{const u=l.dataIndex,y=l.title,S=l.isDate||!1;let g=Z(o,u);g=S?k(g).format(s):g,n.push({propsKey:u,label:y,value:g})}),f(n)},[o]);const C=i?{display:"block",opacity:1}:{display:"none",opacity:0},p=m.map(n=>e.jsxs(X,{gutter:12,children:[e.jsx(W,{className:"gutter-row",span:8,children:e.jsx("p",{children:n.label})}),e.jsx(W,{className:"gutter-row",span:2,children:e.jsx("p",{children:" : "})}),e.jsx(W,{className:"gutter-row",span:14,children:e.jsx("p",{children:n.value})})]},n.propsKey));return e.jsx("div",{style:C,children:p})}function Re({config:a,onRerender:s}){let{entity:r,searchConfig:c}=a;const{displayLabels:d,searchFields:o,outputValue:t="_id"}=c,i=V(),{crudContextAction:m}=A(),{panel:f,collapsedBox:C,readBox:p}=m,{result:n,isLoading:l,isSuccess:u}=P(Fe),[y,S]=x.useState([]),[g,w]=x.useState(void 0),D=x.useRef(!1),[E,T]=x.useState(!1),[B,N]=x.useState(""),[R,U]=x.useState(""),[,Y]=fe(()=>{U(B)},500,[B]),I=j=>d.map(F=>j[F]).join(" ");x.useEffect(()=>{if(R!=""){const j={q:R,fields:o};i(b.search({entity:r,options:j}))}return()=>{Y()}},[R]);const $=j=>{j&&j!=""&&(D.current=!0,T(!0),S([]),w(void 0),N(j))},q=j=>{const F=n.find(h=>h[t]===j);i(b.currentItem({data:F})),f.open(),C.open(),p.open(),s()};return x.useEffect(()=>{D.current&&(u?S(n):(T(!1),w(void 0),S([])))},[u,n]),e.jsx(J,{loading:l,showSearch:!0,allowClear:!0,placeholder:e.jsx(ae,{style:{float:"right",padding:"8px 0"}}),defaultActiveFirstOption:!1,filterOption:!1,notFoundContent:E?"... Searching":e.jsx(le,{}),value:g,onSearch:$,style:{width:"100%"},onSelect:q,children:y.map(j=>e.jsx(J.Option,{value:j[t],children:I(j)},j[t]))})}function mt({config:a}){const[s,r]=x.useState([0]),c=()=>{r([s+1])};return s.map(d=>e.jsx(Re,{config:a,onRerender:c},d))}function Me({config:a}){const{crudContextAction:s}=A(),{collapsedBox:r,panel:c}=s,{ADD_NEW_ENTITY:d}=a,o=()=>{c.open(),r.close()};return e.jsx(G,{onClick:o,type:"primary",children:d})}function ft({config:a,extra:s=[]}){let{entity:r,dataTableColumns:c,DATATABLE_TITLE:d,fields:o,searchConfig:t}=a;const{crudContextAction:i}=A(),{panel:m,collapsedBox:f,modal:C,readBox:p,editBox:n,advancedBox:l}=i,u=K(),{moneyFormatter:y}=me(),{dateFormat:S}=ee(),g=[{label:u("Show"),key:"read",icon:e.jsx(ce,{})},{label:u("Edit"),key:"edit",icon:e.jsx(re,{})},...s,{type:"divider"},{label:u("Delete"),key:"delete",icon:e.jsx(ge,{})}],w=h=>{I(b.currentItem({data:h})),m.open(),f.open(),p.open()};function D(h){I(b.currentItem({data:h})),I(b.currentAction({actionType:"update",data:h})),n.open(),m.open(),f.open()}function E(h){I(b.currentAction({actionType:"delete",data:h})),C.open()}function T(h){I(b.currentItem({data:h})),I(b.currentAction({actionType:"update",data:h})),l.open(),m.open(),f.open()}let B=[];o?B=[...Ne({fields:o,translate:u,moneyFormatter:y,dateFormat:S})]:B=[...c],c=[...B,{title:"",key:"action",fixed:"right",render:(h,L)=>e.jsx(Ie,{menu:{items:g,onClick:({key:M})=>{switch(M){case"read":w(L);break;case"edit":D(L);break;case"delete":E(L);break;case"updatePassword":T(L);break}}},trigger:["click"],children:e.jsx(Te,{style:{cursor:"pointer",fontSize:"24px"},onClick:M=>M.preventDefault()})})}];const{result:N,isLoading:R}=P(Le),{pagination:U,items:Y}=N,I=V(),$=x.useCallback(h=>{const L={page:h.current||1,items:h.pageSize||10};I(b.list({entity:r,options:L}))},[]),q=h=>{const M={q:h.target.value,fields:(t==null?void 0:t.searchFields)||""};I(b.list({entity:r,options:M}))},j=()=>{I(b.list({entity:r}))};x.useEffect(()=>{const h=new AbortController;return j(),()=>{h.abort()}},[]);const F=P(ie);return e.jsxs(e.Fragment,{children:[e.jsx(he,{onBack:()=>window.history.back(),backIcon:F==="rtl"?e.jsx(ve,{}):e.jsx(ye,{}),title:d,ghost:!1,extra:[e.jsx(de,{onChange:q,placeholder:u("search"),allowClear:!0},"searchFilterDataTable}"),e.jsx(G,{onClick:$,icon:e.jsx(pe,{}),children:u("Refresh")},`${H.generate()}`),e.jsx(Me,{config:a},`${H.generate()}`)],style:{padding:"20px 0px",direction:F}}),e.jsx(we,{columns:c,rowKey:h=>h._id,dataSource:Y,pagination:U,loading:R,onChange:$,scroll:{x:!0}})]})}function We({children:a}){return e.jsx(te,{children:a})}const $e=({onChange:a,title:s})=>e.jsx("div",{className:"collapseBoxHeader",onClick:a,children:s}),Ve=({isOpen:a,children:s})=>{const r=a?{display:"block",opacity:1}:{display:"none",opacity:0};return e.jsx("div",{className:"TopCollapseBox",children:e.jsx("div",{style:r,children:e.jsx(X,{children:e.jsxs(W,{span:24,children:[" ",s]})})})})},Ke=({isOpen:a,children:s})=>{const r=a?{display:"none",opacity:0}:{display:"block",opacity:1};return e.jsx("div",{className:"BottomCollapseBox",children:e.jsx("div",{style:r,children:e.jsx(X,{children:e.jsxs(W,{span:24,children:[" ",s]})})})})};function Ue({topContent:a,bottomContent:s,buttonTitle:r,isCollapsed:c,onCollapse:d}){const o=c?"collapsed":"";return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{isOpen:c,children:a}),e.jsxs("div",{className:"collapseBox "+o,children:[e.jsx($e,{title:r,onChange:d}),e.jsx("div",{className:"whiteBg"}),e.jsx(Ke,{isOpen:c,children:s})]})]})}const{useBreakpoint:Ye}=Ae;function qe({config:a,topContent:s,bottomContent:r,fixHeaderPanel:c}){Ye();const{ADD_NEW_ENTITY:d}=a,{state:o,crudContextAction:t}=A(),{isPanelClose:i,isBoxCollapsed:m}=o,{panel:f,collapsedBox:C}=t,[p,n]=x.useState(i),[l,u]=x.useState("-1px"),[y,S]=x.useState(0),[g,w]=x.useState("20px");x.useEffect(()=>{let T=[];return i?(S(0),w("20px"),T=setTimeout(()=>{u("-1px"),n(i)},200)):(n(i),u(0),T=setTimeout(()=>{S(1),w(0)},200)),()=>clearTimeout(T)},[i]);const D=()=>{f.collapse()},E=()=>{C.collapse()};return e.jsx(Be,{title:a.PANEL_TITLE,placement:"right",onClose:D,open:!i,width:450,children:e.jsxs("div",{className:"sidePanelContent",style:{opacity:y,paddingTop:g},children:[c,e.jsx(Ue,{buttonTitle:d,isCollapsed:m,onCollapse:E,topContent:s,bottomContent:r})]})})}const{Content:ze}=ue,He=({children:a})=>{const{state:s,crudContextAction:r}=A();Q();const{isPanelClose:c}=s,[d,o]=x.useState(c);return x.useEffect(()=>{let t=[];return c?t=setTimeout(()=>{o(c)},200):o(c),()=>clearTimeout(t)},[c]),e.jsx(ze,{className:"whiteBox shadow layoutPadding",style:{margin:"30px auto",width:"100%",maxWidth:"100%",flex:"none"},children:a})};function bt({children:a,config:s,sidePanelTopContent:r,sidePanelBottomContent:c,fixHeaderPanel:d}){return e.jsx(e.Fragment,{children:e.jsxs(We,{children:[e.jsx(qe,{config:s,topContent:r,bottomContent:c,fixHeaderPanel:d}),e.jsxs(He,{children:[" ",a]})]})})}export{bt as C,ft as D,ht as R,mt as S,pt as a,xt as b,Ee as c,ut as s};
