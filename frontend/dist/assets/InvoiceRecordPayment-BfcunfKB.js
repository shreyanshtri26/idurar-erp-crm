import{b8 as L,b7 as N,aU as E,a as o,aT as e,b9 as $,bh as w}from"./index--J6gaKqH.js";import{V as I,ae as g,ai as D,O as T,ac as _,aa as b,ab as C}from"./erpOs-CMKQyu82.js";import"./index-sTiArh6c.js";import{a as M,b as B,c as O,E as Y}from"./selectors-APkanmoC.js";import{e as x}from"./actions-DqrCK4Yp.js";import{P as k}from"./index-BcAYd26p.js";import{s as P}from"./index-KrFx5yLV.js";import{u as H}from"./useDate-BUBJ-65Y.js";import{P as U,F as W}from"./PaymentForm-B8kLtCX8.js";import{c as v}from"./calculate-Bl1nHP9U.js";import{t as S}from"./statusTagColor-DxbKI3gy.js";import{T as A}from"./index-BXLypoqc.js";import{D as u}from"./index-Dis4Z6jn.js";import{C as q}from"./CloseCircleOutlined-BRDhjlcW.js";import{s as z}from"./ErpApp-BEAjmWaO.js";import"./currency.es-9OAR_aOO.js";import"./index-BX5vAKpM.js";import"./color-DHucoY0N.js";import"./index-CGa66d7n.js";import"./index-B4MtrW3q.js";function G({config:c}){const r=L(),s=I();let{entity:n}=c;const i=N(),{isLoading:m,isSuccess:l,current:a}=E(M),[f]=g.useForm(),[t,j]=o.useState(0);o.useEffect(()=>{if(a){const{credit:d,total:p,discount:y}=a;j(v.sub(v.sub(p,y),d))}},[a]),o.useEffect(()=>{l&&(f.resetFields(),i(x.resetAction({actionType:"recordPayment"})),i(x.list({entity:n})),r(`/${n}/`))},[l]);const h=d=>{if(a){const{_id:p}=a,y=a.client&&a.client._id;d={...d,invoice:p,client:y}}i(x.recordPayment({entity:"payment",jsonData:d}))};return e.jsx(D,{isLoading:m,children:e.jsxs(g,{form:f,layout:"vertical",onFinish:h,children:[e.jsx(U,{maxAmount:t}),e.jsx(g.Item,{children:e.jsx(T,{type:"primary",htmlType:"submit",children:s("Record Payment")})})]})})}function J({config:c,currentItem:r}){var p,y;const s=I(),{entity:n,ENTITY_NAME:i}=c,m=H(),l=L(),[a,f]=o.useState([]),[t,j]=o.useState(r),[h,d]=o.useState({});return o.useEffect(()=>{t!=null&&t.client&&d(t.client[t.client.type])},[t]),o.useEffect(()=>{const F=new AbortController;if(r){const{items:R}=r;f(R),j(r)}return()=>F.abort()},[r]),o.useEffect(()=>{console.info("itemslist",a)},[a]),e.jsxs(e.Fragment,{children:[e.jsx(_,{gutter:[12,12],children:e.jsxs(b,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(k,{onBack:()=>l(`/${n.toLowerCase()}`),title:`Record Payment for ${i} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx(A,{color:(p=S(t.paymentStatus))==null?void 0:p.color,children:t.paymentStatus&&s(t.paymentStatus)}),extra:[e.jsx(T,{onClick:()=>{l(`/${n.toLowerCase()}`)},icon:e.jsx(q,{}),children:s("Cancel")},`${P.generate()}`),e.jsx(T,{onClick:()=>l(`/invoice/read/${t._id}`),icon:e.jsx(W,{}),children:s("Show Invoice")},`${P.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(C,{dashed:!0})]})}),e.jsxs(_,{gutter:[12,12],children:[e.jsxs(b,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(u,{title:`${s("Client")}  : ${t.client.name}`,column:1,children:[e.jsx(u.Item,{label:s("email"),children:h.email}),e.jsx(u.Item,{label:s("phone"),children:h.phone}),e.jsx(C,{dashed:!0}),e.jsx(u.Item,{label:s("payment status"),children:e.jsx(A,{color:(y=S(t.paymentStatus))==null?void 0:y.color,children:t.paymentStatus&&s(t.paymentStatus)})}),e.jsx(u.Item,{label:s("sub total"),children:m.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(u.Item,{label:s("total"),children:m.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(u.Item,{label:s("discount"),children:m.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(u.Item,{label:s("Paid"),children:m.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(b,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(G,{config:c})})]})]})}function K({config:c}){const r=N(),{id:s}=$();let n=E(B(s));o.useEffect(()=>{r(n?x.currentItem({data:n}):x.read({entity:c.entity,id:s}))},[n,s]);const{result:i}=E(O);n=i;const m=l=>{r(z.updateCurrency({data:{default_currency_code:l}}))};return o.useEffect(()=>{r(x.currentAction({actionType:"recordPayment",data:n})),m(n.currency)},[n]),e.jsx(Y,{children:n?e.jsx(J,{config:c,currentItem:i}):e.jsx(w,{})})}function fe(){const c="invoice",r=I(),s={PANEL_TITLE:r("invoice"),DATATABLE_TITLE:r("invoice_list"),ADD_NEW_ENTITY:r("add_new_invoice"),ENTITY_NAME:r("invoice"),RECORD_ENTITY:r("record_payment")},n={entity:c,...s};return e.jsx(K,{config:n})}export{fe as default};
