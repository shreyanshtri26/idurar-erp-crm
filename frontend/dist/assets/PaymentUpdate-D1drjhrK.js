import{b8 as w,b7 as D,aU as U,a as i,aT as e,b9 as I,bh as M}from"./index--J6gaKqH.js";import{V as L,ae as _,ai as B,O as C,ac as F,aa as E,ab as P,ag as R}from"./erpOs-CMKQyu82.js";import"./index-sTiArh6c.js";import{d as k,s as v,E as S}from"./selectors-APkanmoC.js";import{e as h}from"./actions-DqrCK4Yp.js";import{d as O,P as Y}from"./index-BcAYd26p.js";import{s as A}from"./index-KrFx5yLV.js";import{u as H}from"./useDate-BUBJ-65Y.js";import{c as g}from"./calculate-Bl1nHP9U.js";import{P as V,F as W}from"./PaymentForm-B8kLtCX8.js";import{t as N}from"./statusTagColor-DxbKI3gy.js";import{T as $}from"./index-BXLypoqc.js";import{D as l}from"./index-Dis4Z6jn.js";import{C as q}from"./CloseCircleOutlined-BRDhjlcW.js";import{s as z}from"./ErpApp-BEAjmWaO.js";import"./currency.es-9OAR_aOO.js";import"./index-BX5vAKpM.js";import"./color-DHucoY0N.js";import"./index-CGa66d7n.js";import"./index-B4MtrW3q.js";function G({config:n,currentInvoice:s}){const a=L(),r=w();let{entity:m}=n;const o=D(),{isLoading:d,isSuccess:t}=U(k),[p]=_.useForm(),[j,b]=i.useState(0);i.useEffect(()=>{if(s){const{credit:c,total:y,discount:x,amount:T}=s;b(g.sub(g.sub(y,x),g.sub(g.sub(c,T))));const u={...s};u.date&&(u.date=O(u.date)),p.setFieldsValue(u)}},[s]),i.useEffect(()=>{t&&(p.resetFields(),o(h.resetAction({actionType:"recordPayment"})),o(h.list({entity:m})),r(`/${m.toLowerCase()}/read/${s._id}`))},[t]);const f=c=>{if(s){const{_id:y}=s,x=s.client&&s.client._id;c={...c,invoice:y,client:x}}o(h.update({entity:m,id:s._id,jsonData:c}))};return e.jsx(e.Fragment,{children:e.jsx(B,{isLoading:d,children:e.jsxs(_,{form:p,layout:"vertical",onFinish:f,children:[e.jsx(V,{maxAmount:j}),e.jsx(_.Item,{children:e.jsx(C,{type:"primary",htmlType:"submit",children:a("Update")})})]})})})}function J({config:n,currentItem:s}){var f,c;const a=L(),{entity:r,ENTITY_NAME:m}=n,o=H(),d=w(),[t,p]=i.useState(s);i.useEffect(()=>{const y=new AbortController;if(s){const{invoice:x,_id:T,...u}=s;p({...u,...x,_id:T})}return()=>y.abort()},[s]);const[j,b]=i.useState({});return i.useEffect(()=>{t!=null&&t.client&&b(t.client[t.client.type])},[t]),e.jsxs(e.Fragment,{children:[e.jsx(F,{gutter:[12,12],children:e.jsxs(E,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[e.jsx(Y,{onBack:()=>d(`/${r.toLowerCase()}`),title:`Update  ${m} # ${t.number}/${t.year||""}`,ghost:!1,tags:e.jsx($,{color:(f=N(t.paymentStatus))==null?void 0:f.color,children:t.paymentStatus}),extra:[e.jsx(C,{onClick:()=>{d(`/${r.toLowerCase()}`)},icon:e.jsx(q,{}),children:a("Cancel")},`${A.generate()}`),e.jsx(C,{onClick:()=>d(`/invoice/read/${t._id}`),icon:e.jsx(W,{}),children:a("Show invoice")},`${A.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(P,{dashed:!0})]})}),e.jsxs(F,{gutter:[12,12],children:[e.jsxs(E,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[e.jsx("div",{className:"space50"}),e.jsxs(l,{title:`${a("Client")} : ${t.client.name}`,column:1,children:[e.jsx(l.Item,{label:a("email"),children:j.email}),e.jsx(l.Item,{label:a("Phone"),children:j.phone}),e.jsx(P,{dashed:!0}),e.jsx(l.Item,{label:a("Payment Status"),children:e.jsx($,{color:(c=N(t.paymentStatus))==null?void 0:c.color,children:t.paymentStatus})}),e.jsx(l.Item,{label:a("SubTotal"),children:o.moneyFormatter({amount:t.subTotal,currency_code:t.currency})}),e.jsx(l.Item,{label:a("Total"),children:o.moneyFormatter({amount:t.total,currency_code:t.currency})}),e.jsx(l.Item,{label:"Discount",children:o.moneyFormatter({amount:t.discount,currency_code:t.currency})}),e.jsx(l.Item,{label:"Balance",children:o.moneyFormatter({amount:t.credit,currency_code:t.currency})})]})]}),e.jsx(E,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:e.jsx(G,{config:n,currentInvoice:t})})]})]})}function K({config:n}){const s=D(),{id:a}=I();i.useLayoutEffect(()=>{s(h.read({entity:n.entity,id:a}))},[a]);const{result:r,isSuccess:m,isLoading:o=!0}=U(v),d=t=>{s(z.updateCurrency({data:{default_currency_code:t}}))};return i.useLayoutEffect(()=>{r&&(s(h.currentAction({actionType:"update",id:a,data:r})),d(r.currency))},[r]),o?e.jsx(S,{children:e.jsx(M,{})}):e.jsx(S,{children:m?e.jsx(J,{config:n,currentItem:r}):e.jsx(R,{entity:n.entity})})}function je(){const n=L(),s="payment",a={PANEL_TITLE:n("payment"),DATATABLE_TITLE:n("payment_list"),ADD_NEW_ENTITY:n("add_new_payment"),ENTITY_NAME:n("payment")},r={entity:s,...a};return e.jsx(K,{config:r})}export{je as default};
